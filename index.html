<DOCUMENT filename="index (91).html">

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مكتبة ناصر ابن داوود</title>
    <style>
        /* أضف أنماط CSS هنا إذا لزم الأمر */
    </style>
</head>
<body>

    🤖 منصة متوافقة مع الذكاء الاصطناعي - آخر تحديث: <span id="last-update"></span>

    <!-- باقي محتوى HTML هنا، مثل القوائم والأقسام -->

    <script>
        let libraryBooks = {
            "books": [
                {
                    "id": "conscious-contemplation",
                    "title_ar": "نحو تدبر واعٍ",
                    "title_en": "Towards Conscious Contemplation",
                    "description_ar": "كتاب يشرح منهجية التدبر العميق للقرآن الكريم وتطبيقاته العصرية",
                    "description_en": "A practical guide to deep understanding and applying the Noble Quran in the modern era",
                    "category": "quranic_studies",
                    "pages_ar": 91,
                    "pages_en": 126,
                    "links": {
                        "ar": {
                            "docx": "https://drive.google.com/uc?export=download&id=17AkqVDGa9GOoGEpCHmk1yfQ9t9uIgUV2",
                            "html": "https://drive.google.com/uc?export=download&id=1CjD4C5WZBg6Nl7JTHMdvrgMbHI1GRVem",
                            "pdf": "books/conscious-contemplation/ar/content.pdf",
                            "pdf_external": "https://drive.google.com/uc?export=download&id=1rMSGwIltsrPSjT4RLoX8ds21MyB633i7",
                            "text": "books/conscious-contemplation/ar/content.txt",
                            "text_external": "https://drive.google.com/uc?export=download&id=1ZjCEi5V3dye2T0fwpAExfnM9haDKhnQF",
                            "archive_text": "https://archive.org/stream/20250529_20250529_2132/%D9%86%D8%AD%D9%88%20%D8%AA%D8%AF%D8%A8%D8%B1%D9%8D%20%D9%88%D8%A7%D8%B9%D9%8D%20%D8%AF%D9%84%D9%8A%D9%84%20%D8%B9%D9%85%D9%84%D9%8A%20%D9%84%D9%81%D9%87%D9%85%20%D9%88%D8%AA%D8%B7%D8%A8%D9%8A%D9%82%20%D8%A7%D9%84%D9%82%D8%B1%D8%A2%D9%86%20%D8%A7%D9%84%D9%83%D8%B1%D9%8A%D9%85%20%D9%81%D9%8A%20%D8%A7%D9%84%D8%B9%D8%B5%D8%B1%20%D8%A7%D9%84%D8%AD%D8%AF%D9%8A%D8%AB_djvu.txt",
                            "archive_pdf": "https://dn720702.ca.archive.org/0/items/20250529_20250529_2132/%D9%86%D8%AD%D9%88%20%D8%AA%D8%AF%D8%A8%D8%B1%D9%8D%20%D9%88%D8%A7%D8%B9%D9%8D%20%D8%AF%D9%84%D9%8A%D9%84%20%D8%B9%D9%85%D9%84%D9%8A%20%D9%84%D9%81%D9%87%D9%85%20%D9%88%D8%AA%D8%B7%D8%A8%D9%8A%D9%82%20%D8%A7%D9%84%D9%82%D8%B1%D8%A2%D9%86%20%D8%A7%D9%84%D9%83%D8%B1%D9%8A%D9%85%20%D9%81%D9%8A%20%D8%A7%D9%84%D8%B9%D8%B5%D8%B1%20%D8%A7%D9%84%D8%AD%D8%AF%D9%8A%D8%AB.pdf",
                            "cover": "books/conscious-contemplation/ar/cover-ar.png"
                        },
                        "en": {
                            "docx": "https://drive.google.com/uc?export=download&id=18FP0NmPM1CHSCZs0UDLnLBGSrqfEJWlX",
                            "html": "https://drive.google.com/uc?export=download&id=11gaZUgs7DkUBe_8OABu1remHgaEfZmnn",
                            "pdf": "books/conscious-contemplation/en/content.pdf",
                            "pdf_external": "https://drive.google.com/uc?export=download&id=1yKPdEMoAMHXLmKlhaSVhy61tjWoVEVbv",
                            "text": "books/conscious-contemplation/en/content.txt",
                            "text_external": "https://drive.google.com/uc?export=download&id=1sWN_QZ-Ovmam3g2Y-I_a1OXkV4wFiqYb",
                            "archive_text": "https://archive.org/stream/towards-conscious-contemplation-a-practical-guide-to-understanding-and-applying-/TOWARDS%20CONSCIOUS%20CONTEMPLATION%20%20%20A%20PRACTICAL%20GUIDE%20TO%20UNDERSTANDING%20AND%20APPLYING%20THE%20NOBLE%20QUR%27AN%20IN%20THE%20MODERN%20ERA_djvu.txt",
                            "archive_pdf": "https://ia800602.us.archive.org/9/items/towards-conscious-contemplation-a-practical-guide-to-understanding-and-applying-/TOWARDS%20CONSCIOUS%20CONTEMPLATION%20%20%20A%20PRACTICAL%20GUIDE%20TO%20UNDERSTANDING%20AND%20APPLYING%20THE%20NOBLE%20QUR%27AN%20IN%20THE%20MODERN%20ERA.pdf",
                            "cover": "books/conscious-contemplation/en/cover-en.png"
                        },
                        "page": {
                            "ar": "books/conscious-contemplation/ar/index.html",
                            "en": "books/conscious-contemplation/en/index.html"
                        }
                    },
                    "cover": {
                        "ar": "https://nasserhabitat.github.io/nasser-books/books/conscious-contemplation/ar/cover-ar.png",
                        "en": "https://nasserhabitat.github.io/nasser-books/books/conscious-contemplation/en/cover-en.png"
                    },
                    "ai_access": {
                        "structured_data": true,
                        "api_accessible": true,
                        "content_analysis": true,
                        "formats": ["html", "pdf", "txt"],
                        "topics": ["تدبر القرآن", "فهم القرآن", "تطبيق القرآن", "منهجية التدبر", "القرآن في العصر الحديث", "نور العقل", "رقمنة المخطوطات القرآنية", "الرسم العثماني", "المخطوطات القرآنية الأصلية", "منهج حياة", "الفهم الواعي للقرآن", "آيات القرآن", "القرآن الكريم", "تدبر عملي", "ناصر ابن داوود"]
                    },
                    "content_ar": null,
                    "content_en": null,
                    "publishedDate": "2025-01-22T12:00:00Z"
                },
                {
                    "id": "anwar-al-bayan",
                    "title_ar": "أنوار البيان في رسم المصحف العثماني: الكشف عن أسرار اللسان",
                    "title_en": "Anwar Al-Bayan in the Drawing of the Ottoman Quran: Unveiling the Secrets of the Tongue",
                    "description_ar": "دراسة علمية متعمقة للرسم العثماني وأسراره اللغوية في فهم القرآن الكريم",
                    "description_en": "A scientific study revealing the linguistic secrets of the Ottoman Quranic script",
                    "category": "quranic_studies",
                    "pages_ar": 161,
                    "pages_en": 215,
                    "links": {
                        "ar": {
                            "docx": "https://drive.google.com/uc?export=download&id=1VjEJEjjrJbM7glhR2lHEsqB1L94t2XCu",
                            "html": "https://drive.google.com/uc?export=download&id=1OuuQzbqrCW9blAvWc2AIpHdM9sl4bYUB",
                            "pdf": "books/anwar-al-bayan/ar/content.pdf",
                            "pdf_external": "https://drive.google.com/uc?export=download&id=1OuuQzbqrCW9blAvWc2AIpHdM9sl4bYUB",
                            "text": "books/anwar-al-bayan/ar/content.txt",
                            "text_external": "https://drive.google.com/uc?export=download&id=1O0uafxgb-EXpmiOZaNnLEx73okvilKZl",
                            "archive_text": "https://archive.org/stream/20250529_20250529_2033/%D8%A3%D9%86%D9%88%D8%A7%D8%B1%20%D8%A7%D9%84%D8%A8%D9%8A%D8%A7%D9%86%20%D9%81%D9%8A%20%D8%B1%D8%B3%D9%85%20%D8%A7%D9%84%D9%85%D8%B5%D8%AD%D9%81%20%D8%A7%D9%84%D8%B9%D8%AB%D9%85%D8%A7%D9%86%D9%8A%20%D8%A7%D9%84%D9%83%D8%B4%D9%81%20%D8%B9%D9%86%20%D8%A3%D8%B3%D8%B1%D8%A7%D8%B1%20%D8%A7%D9%84%D9%84%D8%B3%D8%A7%D9%86_djvu.txt",
                            "archive_pdf": "https://dn721701.ca.archive.org/0/items/20250529_20250529_2033/%D8%A3%D9%86%D9%88%D8%A7%D8%B1%20%D8%A7%D9%84%D8%A8%D9%8A%D8%A7%D9%86%20%D9%81%D9%8A%20%D8%B1%D8%B3%D9%85%20%D8%A7%D9%84%D9%85%D8%B5%D8%AD%D9%81%20%D8%A7%D9%84%D8%B9%D8%AB%D9%85%D8%A7%D9%86%D9%8A%20%D8%A7%D9%84%D9%83%D8%B4%D9%81%20%D8%B9%D9%86%20%D8%A3%D8%B3%D8%B1%D8%A7%D8%B1%20%D8%A7%D9%84%D9%84%D8%B3%D8%A7%D9%86.pdf",
                            "cover": "books/anwar-al-bayan/ar/cover-ar.png"
                        },
                        "en": {
                            "docx": "https://drive.google.com/uc?export=download&id=1TVOxURf1EI8Oq774aUANI7WRqbg5MbOi",
                            "html": "https://drive.google.com/uc?export=download&id=1s0x6gR0p7zfHuQIN7C8mpYT82NyHysEX",
                            "pdf": "books/anwar-al-bayan/en/content.pdf",
                            "pdf_external": "https://drive.google.com/uc?export=download&id=1kyDrHDpYAWA1G0KE8Ow5e5VIk-lbM6zZ",
                            "text": "books/anwar-al-bayan/en/content.txt",
                            "text_external": "https://drive.google.com/uc?export=download&id=1vo44VX03M_ZR-ISriWgqAteOrvG8HMu2",
                            "archive_text": "https://archive.org/stream/anwar-al-bayan-in-the-drawing-of-the-ottoman-qur-an-revealing-the-secrets-of-the-tongue/ANWAR%20AL-BAYAN%20IN%20THE%20DRAWING%20OF%20THE%20OTTOMAN%20QUR%27AN%20%20%20REVEALING%20THE%20SECRETS%20OF%20THE%20TONGUE_djvu.txt",
                            "archive_pdf": "https://dn721503.ca.archive.org/0/items/anwar-al-bayan-in-the-drawing-of-the-ottoman-qur-an-revealing-the-secrets-of-the-tongue/ANWAR%20AL-BAYAN%20IN%20THE%20DRAWING%20OF%20THE%20OTTOMAN%20QUR%27AN%20%20%20REVEALING%20THE%20SECRETS%20OF%20THE%20TONGUE.pdf",
                            "cover": "books/anwar-al-bayan/en/cover-en.png"
                        },
                        "page": {
                            "ar": "books/anwar-al-bayan/ar/index.html",
                            "en": "books/anwar-al-bayan/en/index.html"
                        }
                    },
                    "cover": {
                        "ar": "https://nasserhabitat.github.io/nasser-books/books/anwar-al-bayan/ar/cover-ar.png",
                        "en": "https://nasserhabitat.github.io/nasser-books/books/anwar-al-bayan/en/cover-en.png"
                    },
                    "ai_access": {
                        "structured_data": true,
                        "api_accessible": true,
                        "content_analysis": true,
                        "formats": ["html", "pdf", "txt"],
                        "topics": ["الرسم العثماني", "المصحف العثماني", "أسرار اللسان", "أنوار البيان", "تدبر القرآن", "المخطوطات الرقمية", "اللغة العربية", "علوم القرآن", "القرآن الكريم", "الفهم العميق", "الدراسات القرآنية", "التفسير", "الخط العربي", "الكتابة القرآنية"]
                    },
                    "content_ar": null,
                    "content_en": null,
                    "publishedDate": "2025-01-22T12:00:00Z"
                },
                // ... (باقي الكتب هنا، اختصرتها للاختصار، أضف الباقي كما في الأصل)
            ]
        };

        let allBooks = [...libraryBooks.books];
        let bookContent = {};
        const formatsMap = {
            'docx': 'DOCX',
            'html': 'HTML',
            'pdf': 'PDF',
            'text': 'TEXT',
            'pdf_external': 'External PDF',
            'text_external': 'External TEXT',
            'archive_text': 'Archive Text',
            'archive_pdf': 'Archive PDF'
        };
        const langMap = {
            'ar': {
                'pdf_label': 'تحميل PDF',
                'read_more_label': 'روابط التحميل',
                'formats_title': 'روابط التحميل',
                'no_desc': 'لا يوجد وصف متاح.',
                'more_link_label': 'قراءة المزيد',
                'read_direct_label': 'قراءة مباشرة'
            },
            'en': {
                'pdf_label': 'Download PDF',
                'read_more_label': 'Download Links',
                'formats_title': 'Download Links',
                'no_desc': 'No description available.',
                'more_link_label': 'Read More',
                'read_direct_label': 'Read Directly'
            }
        };

        // باقي الكود JavaScript هنا، مع إصلاح أي أخطاء نحوية أو منطقية محتملة
        // مثل إكمال innerHTML في createBookCard بشكل صحيح، افترض أنه كان ناقصاً في الأصل

        function getLang() {
            return document.documentElement.lang || 'ar';
        }

        function updateLastUpdateTime() {
            const lastUpdateSpan = document.getElementById('last-update');
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            lastUpdateSpan.textContent = now.toLocaleDateString('ar-EG', options);
        }

        function generateDownloadLinks(book, lang) {
            let linksHtml = '';
            const links = book.links[lang];
            if (links) {
                linksHtml += `<h3>${langMap[lang].formats_title}</h3>`;
                linksHtml += '<ul>';
                for (const key in links) {
                    if (links.hasOwnProperty(key) && formatsMap[key] && key !== 'cover') {
                        linksHtml += `<li><a href="${links[key]}" target="_blank">${formatsMap[key] || key.toUpperCase()}</a></li>`;
                    }
                }
                linksHtml += '</ul>';
            }
            return linksHtml;
        }

        function createBookCard(book, viewType = 'grid') {
            const lang = getLang();
            const card = document.createElement('div');
            card.className = 'book-card';
            card.setAttribute('data-category', book.category);
            card.setAttribute('data-ai-access', JSON.stringify(book.ai_access));
            card.setAttribute('data-id', book.id);

            const isNew = new Date(book.publishedDate) > new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);
            const bookTitle = book[`title_${lang}`] || book.title_ar;
            const bookCover = book.cover[lang] || book.cover.ar;
            const bookDesc = book[`description_${lang}`] || langMap[lang].no_desc;
            const bookPages = book[`pages_${lang}`] || book.pages_ar || 'غير محدد';

            // Check for English version
            const hasEnglishVersion = book.links.page && book.links.page.en;

            // 1. Create the "EN" badge for the cover
            const enBadgeHtml = hasEnglishVersion ? '<span class="en-badge">EN</span>' : '';

            // 2. Create the "English Version" button and text link
            let englishVersionHtml = '';
            if (hasEnglishVersion) {
                englishVersionHtml = `
                    <button class="english-btn">English Version</button>
                    <p>Available in English</p>
                `;
            }

            // Check for "Read More" page link for the current language
            const hasPageLink = book.links.page && book.links.page[lang];
            const pageLinkHtml = hasPageLink ? `<a href="${book.links.page[lang]}" class="more-link">${langMap[lang].more_link_label}</a>` : '';

            card.innerHTML = `
                ${isNew ? `<span class="new-badge">${lang === 'ar' ? 'جديد' : 'New'}</span>` : ''}
                <div class="book-cover">
                    ${enBadgeHtml}
                    <img src="${bookCover}" alt="${bookTitle}">
                    <span class="ai-badge">AI Ready</span>
                </div>
                <div class="book-info">
                    <h2>${bookTitle}</h2>
                    <p class="author-pages">${book.author || 'ناصر ابن داوود'} | ${bookPages} صفحة</p>
                    <p class="description">${bookDesc}</p>
                    <div class="ai-formats">
                        ${book.ai_access.formats.map(format => `<span>${format.toUpperCase()}</span>`).join('')}
                    </div>
                    ${generateDownloadLinks(book, lang)}
                    <button class="read-direct-btn">${langMap[lang].read_direct_label}</button>
                    ${englishVersionHtml}
                    ${pageLinkHtml}
                </div>
            `;

            // Add event listener for read button
            const readBtn = card.querySelector('.read-direct-btn');
            if (readBtn) {
                readBtn.addEventListener('click', () => openReader(book.id, lang));
            }

            return card;
        }

        // باقي الدوال كما هي، مع التأكد من عدم وجود أخطاء

        document.addEventListener('DOMContentLoaded', async function() {
            updateLastUpdateTime();
            loadBooks();
            await preloadBookContents();
            setupSearch();
            setupFilterButtons();
            setupNewBooksFilter();
            setupAdvancedFilters();
            setupViewOptions();
            
            const closeBtn = document.querySelector('.reader-close');
            if (closeBtn) {
                closeBtn.onclick = function() {
                    const modal = document.getElementById('reader-modal');
                    modal.style.display = "none";
                    document.getElementById('reader-container').innerHTML = '';
                }
            }

            window.onclick = function(event) {
                const modal = document.getElementById('reader-modal');
                if (event.target == modal) {
                    modal.style.display = "none";
                    document.getElementById('reader-container').innerHTML = '';
                }
            }
            
            setInterval(() => {
                updateLastUpdateTime();
            }, 3600000);
        });
    </script>

</body>
</html>

</DOCUMENT>
